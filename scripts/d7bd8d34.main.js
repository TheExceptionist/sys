window.Tracker=function(){"use strict";function a(){var a=g();document.cookie.indexOf("disableTracking=true")>-1&&this.disableTracking(),"prod"===a?ga("create",f,"auto",{name:"neelabhgProd"}):"angraveprod"===a?(ga("create",c,"auto",{name:"angraveOldProd"}),ga("create",d,"auto",{name:"neelabhgOldProd"})):"staging"===a&&ga("create",e,"auto",{name:"neelabhgStaging"})}var b,c="UA-42515111-2",d="UA-39700861-4",e="UA-39700861-5",f="UA-39700861-6",g=function(){var a=window.location.hostname+window.location.pathname;return"cs-education.github.io/sys/"===a?"prod":"angrave.github.io/sys/"===a?"angraveprod":"cs-education.github.io/sys-staging/"===a?"staging":"dev"};return a.prototype.disableTracking=function(){window["ga-disable-"+c]=!0,window["ga-disable-"+d]=!0,window["ga-disable-"+e]=!0,window["ga-disable-"+f]=!0},a.prototype.isTrackingEnabled=function(){return!(window["ga-disable-"+c]&&window["ga-disable-"+d]&&window["ga-disable-"+e]&&window["ga-disable-"+f])},a.prototype.optout=function(){document.cookie="disableTracking=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/",this.disableTracking()},a.prototype.trackEvent=function(){var a=Array.prototype.slice.call(arguments);a.unshift("event"),ga(function(){ga.getAll().forEach(function(b){b.send.apply(b,a)})})},a.prototype.trackPageView=function(a,b){var c={page:a||window.location.pathname+window.location.search+window.location.hash};b&&(c.title=b),ga(function(){ga.getAll().forEach(function(a){a.send("pageview",c)})})},{getInstance:function(){return b||(b=new a,b.constructor=null),b}}}(),window.SysViewModel=function(){"use strict";function a(){var a=this,b={Waiting:"default",Ready:"success",Compiling:"primary",Cancelled:"default",Success:"success",Warnings:"default-light",Failed:"default-light"},c={Stopped:"danger",Booting:"warning",Running:"success",Paused:"default"},d={life:5e3,theme:"ruby",icon:"exclamation-triangle"},e={life:5e3,theme:"lemon",icon:"info-circled"},f={life:5e3,theme:"lime",icon:"check-mark-2"};a.challengeDoc=ko.observable(""),a.editorText=ko.observable(""),a.gccErrorCount=ko.observable(0),a.gccWarningCount=ko.observable(0),a.gccOptions=ko.observable(""),a.gccOptsError=ko.observable(""),a.programArgs=ko.observable(""),a.lastGccOutput=ko.observable(""),a.compileStatus=ko.observable("Waiting"),a.compileStatusClass=ko.pureComputed(function(){return"label label-"+b[a.compileStatus()]}),a.compileBtnEnable=ko.pureComputed(function(){var b=!("Waiting"===a.compileStatus()||"Compiling"===a.compileStatus());return b?$.notific8("The compiler is now online",f):$.notific8("The compiler is currently busy",e),b}),a.compileBtnTooltip=ko.observable(),a.errorWarningLabel=ko.pureComputed(function(){var b=a.gccErrorCount(),c=a.gccWarningCount(),d="";return d+=b?'<span class="compile-status-label-text-error">'+(b+" error"+(b>1?"s ":""))+(c?"":"…")+"</span>":"",d+=c?'&nbsp;<span class="compile-status-label-text-warning">'+(c+" warning"+(c>1?"s":""))+"…</span>":"",!d&&a.showErrorWarningLabel()&&(d='<span class="compile-status-label-text-error">'+a.compileStatus()+"…</span>"),d}),a.showErrorWarningLabel=ko.pureComputed(function(){var b="Warnings"===a.compileStatus()||"Failed"===a.compileStatus();return b&&$.notific8("There were errors or warnings during compilation",d),b}),a.vmState=ko.observable("Stopped"),a.vmStateClass=ko.pureComputed(function(){return"label label-"+c[a.vmState()]}),a.availableAceThemes=ko.observableArray(["monokai","terminal","tomorrow","xcode"]),a.aceTheme=ko.observable(a.availableAceThemes()[0]),a.aceFontSize=ko.observable(),a.ttyContainer=$("#tty-container"),a.ttyContainerTwo=$("#tty-container-two"),a.currentTTYContainer=a.ttyContainer,a.ttyFullScreen=ko.observable(!1),a.ttyFullScreen.subscribe(function(b){b?(a.ttyContainer.appendTo("body"),a.ttyContainerTwo.appendTo("body")):(a.ttyContainer.appendTo("#tty-pane"),a.ttyContainerTwo.appendTo("#tty-pane")),SysRuntime.getInstance().focusTerm(a.isPrimaryTTY()?"tty0":"tty1")}),a.isPrimaryTTY=ko.observable(!0),a.isPrimaryTTY.subscribe(function(b){a.currentTTYContainer.hide(),b?(a.currentTTYContainer=a.ttyContainer,SysRuntime.getInstance().focusTerm("tty0")):(a.currentTTYContainer=a.ttyContainerTwo,SysRuntime.getInstance().focusTerm("tty1")),a.currentTTYContainer.show()}),a.ttyToggleBtnClass=ko.pureComputed(function(){return"glyphicon "+(a.ttyFullScreen()?"glyphicon-resize-small":"glyphicon-resize-full")}),a.ttySwitchBtnClass=ko.pureComputed(function(){return"glyphicon "+(a.isPrimaryTTY()?"glyphicon-chevron-right":"glyphicon-chevron-left")}),a.openManPageTabs=ko.observableArray(),a.currentActiveTabIndex=ko.observable(-2),a.closeManPageTab=function(b){var c=a.currentActiveTabIndex(),d=a.openManPageTabs.indexOf(b);a.openManPageTabs.splice(d,1),c>=d&&(c-=1),a.currentActiveTabIndex(c)},a.chapters=ko.observableArray([]),a.currentChapterIdx=ko.observable(0),a.currentChapter=ko.observable(),a.currentSectionIdx=ko.observable(0),a.currentSection=ko.observable(),a.currentActivityIdx=ko.observable(0),a.currentActivity=ko.observable(),a.currentVideoFilePrefix=ko.observable(),a.currentVideoTopics=ko.observable(),a.currentVideoDoc=ko.observable(),a.shownPage=ko.observable(),a.shownPage.subscribe(function(a){"playground"===a?$("body").css("overflow","hidden"):$("body").css("overflow","auto")}),a.getNavUrlPrev=ko.pureComputed(function(){var b=a.currentChapter(),c=parseInt(a.currentSectionIdx(),10),d=parseInt(a.currentActivityIdx(),10),e=b?b.sections[c-1]:null,f=e?e.activities.length:1,g=c,h=d-1;return 0>h&&(g-=1,h=f-1),"#chapter/"+a.currentChapterIdx()+"/section/"+g+"/activity/"+h}),a.getNavUrlNext=ko.pureComputed(function(){var b=a.currentSection(),c=parseInt(a.currentSectionIdx(),10),d=parseInt(a.currentActivityIdx(),10),e=b?b.activities.length:1,f=c,g=d+1;return g>=e&&(f+=1,g=0),"#chapter/"+a.currentChapterIdx()+"/section/"+f+"/activity/"+g}),a.playGroundNavPagerVisible=ko.observable()}var b;return a.prototype.setSysPlayGroundState=function(a){a=a||{},a.challengeDoc&&this.challengeDoc(a.challengeDoc),a.gccOptions&&this.gccOptions(a.gccOptions),a.programArgs&&this.programArgs(a.programArgs),a.editorText&&this.editorText(a.editorText)},{getInstance:function(){return b||(b=new a,b.constructor=null),b}}}(),window.Preferences=function(){"use strict";function a(){var a=this;try{a.useLocalStorage="undefined"!==localStorage}catch(b){console.log(b),a.useLocalStorage=!1}}function b(a,b){var c=this;c.manager=b,c.prefix="preferences/"+a}var c,d=[];return a.prototype.setItem=function(a,b){if(this.useLocalStorage)try{localStorage.setItem(a,b)}catch(c){console.log(c)}},a.prototype.getItem=function(a,b){if(!this.useLocalStorage)return b;try{var c=localStorage.getItem(a);return null!==c?c:b}catch(d){return console.log(d),b}},a.prototype.removeItem=function(a){if(this.useLocalStorage)try{localStorage.removeItem(a)}catch(b){console.log(b)}},a.prototype.clear=function(){if(this.useLocalStorage)try{localStorage.clear()}catch(a){console.log(a)}},b.prototype.setItem=function(a,b){this.manager.setItem(this.prefix+"/"+a,b)},b.prototype.getItem=function(a,b){return this.manager.getItem(this.prefix+"/"+a,b)},b.prototype.removeItem=function(a){this.manager.removeItem(this.prefix+"/"+a)},{getInstance:function(e){return c||(c=new a,c.constructor=null),d[e]||(d[e]=new b(e,c)),d[e]}}}(),window.ExpectTTY=function(){"use strict";function a(a,b,c,d){this.output="",this.callback=d,this.putCharEventName="putchar-"+b,this.expect=c,this.sys=a,this.found=!1,this.expectPutCharListener=function(a,b){this.output=this.output.substr(this.output.length===this.expect.length?1:0)+b,this.output===this.expect&&(this._cleanup(),this.callback(!0))}.bind(this),this.sys.addListener(this.putCharEventName,this.expectPutCharListener)}return a.prototype._cleanup=function(){this.sys.removeListener(this.putCharEventName,this.expectPutCharListener)},a.prototype.cancel=function(){this._cleanup(),this.callback(!1)},a}(),window.TokenHighlighter=function(){"use strict";function a(a,b,c){var d=this;d.aceEditor=a.aceEditor,d.tokens=b,d.eventCallback=c,d.supportedTypes={identifier:1,"support.function.C99.c":1},d.markers=[],d.tokenStore={},d.busy=!1;var e=null;d.aceEditor.on("change",function(){clearTimeout(e),d.busy||(e=setTimeout(d.highlightTokens.bind(d),500))});var f=function(a){var b=a.getCursorPosition(),c=a.session.getTokenAt(b.row,b.column);a.TokenHighlighter.eventHandler(c)};a.addKeyboardCommand("tokenHighlightShortcut",{win:"Ctrl-I",mac:"Command-I"},f),d.aceEditor.on("click",d.onClick.bind(d))}var b=ace.require("ace/range").Range;return a.prototype.highlightTokens=function(){var a=this;a.busy=!0;var c=a.aceEditor.session,d=c.getLength(),e=a.tokens,f=1,g=0;a.markers.forEach(function(a){c.removeMarker(a)}),a.markers=[];var h=function(d){a.supportedTypes[d.type]&&e.get(d.value,function(e){var h=0;if(e.length&&e[h].name===d.value){for(var i=e[h];i&&2!==i.section&&3!==i.section;)i=e[++h];if(i){a.tokenStore[d.value]=i;var j=new b(f,g,f,g+d.value.length);a.markers.push(c.addMarker(j,"token-highlight","text"))}}}),g+=d.value.length};for(f=1;d>=f;f++){var i=c.getTokens(f);g=0,i.forEach(h)}a.busy=!1},a.prototype.onClick=function(a){var b=a.editor,c=b.renderer,d=c.rect||(c.rect=c.scroller.getBoundingClientRect()),e=(a.clientX+c.scrollLeft-d.left-c.$padding)/c.characterWidth,f=Math.floor((a.clientY+c.scrollTop-d.top)/c.lineHeight),g=Math.round(e),h={row:f,column:g,side:e-g>0?1:-1},i=b.session.getTokenAt(h.row,h.column);i&&this.supportedTypes[i.type]&&this.eventHandler(i)},a.prototype.eventHandler=function(a){this.tokenStore[a.value]&&this.eventCallback(this.tokenStore[a.value])},a.prototype.destroy=function(){delete this.aceEditor.TokenHighlighter},a}(),window.Editor=function(){"use strict";function a(a){var c=this;c.editorId=b,b+=1,c.viewModel=SysViewModel.getInstance(),c.editorDivId=a,c.aceEditor=ace.edit(a),c.setMode("c_cpp"),c.aceEditor.getSession().setTabSize(4),c.aceEditor.getSession().setUseSoftTabs(!0),c.preferences=Preferences.getInstance("editor");var d=c.preferences.getItem("autoindent","true"),e=c.preferences.getItem("highlightline","true"),f=c.preferences.getItem("showinvisibles","false"),g=c.preferences.getItem("theme",c.viewModel.aceTheme()),h=c.preferences.getItem("fontsize",12);c.backgroundAutoIndent="true"===d,c.aceEditor.setHighlightActiveLine("true"===e),c.aceEditor.setShowInvisibles("true"===f),c.setTheme(g),c.viewModel.aceTheme(g),c.setFontSize(h+"px"),c.viewModel.aceFontSize(h),c.viewModel.aceTheme.subscribe(function(a){c.setTheme(a),c.preferences.setItem("theme",a)}),c.viewModel.aceFontSize.subscribe(function(a){c.setFontSize(a+"px"),c.preferences.setItem("fontsize",a)}),c.viewModel.editorText.subscribe(function(a){c.setText(a)}),c.aceEditor.on("change",function(){c.backgroundAutoIndent&&(window.clearTimeout(c.reIndentTimer),c.reIndenting||(c.reIndentTimer=window.setTimeout(c.autoIndentCode.bind(c),500)))}),c.elementIdPrefix="editor"+c.editorId+"-";var i=$("<div>").append($("<form>").append($("<div>").attr("class","checkbox").append($("<label>").append($("<input>").attr({id:c.elementIdPrefix+"autoindent-checkbox",type:"checkbox"})).append($("<span>").text("Autoindent code")))).append($("<div>").attr("class","checkbox").append($("<label>").append($("<input>").attr({id:c.elementIdPrefix+"ace-highlight-active-lines-checkbox",type:"checkbox"})).append($("<span>").text("Highlight Active Line")))).append($("<div>").attr("class","checkbox").append($("<label>").append($("<input>").attr({id:c.elementIdPrefix+"ace-show-invisibles-checkbox",type:"checkbox"})).append($("<span>").text("Show invisible characters"))))),j=$("#editor-settings-btn");j.popover({title:function(){return"Editor settings"},content:function(){return i.html()}}),j.on("shown.bs.popover",function(){$("#"+c.elementIdPrefix+"autoindent-checkbox").prop("checked",c.backgroundAutoIndent),$("#"+c.elementIdPrefix+"ace-highlight-active-lines-checkbox").prop("checked",c.aceEditor.getHighlightActiveLine()),$("#"+c.elementIdPrefix+"ace-show-invisibles-checkbox").prop("checked",c.aceEditor.getShowInvisibles())});var k=$("body");k.on("change","#"+c.elementIdPrefix+"autoindent-checkbox",function(){c.backgroundAutoIndent=this.checked,c.preferences.setItem("autoindent",this.checked)}),k.on("change","#"+c.elementIdPrefix+"ace-highlight-active-lines-checkbox",function(){c.aceEditor.setHighlightActiveLine(this.checked),c.preferences.setItem("highlightline",this.checked)}),k.on("change","#"+c.elementIdPrefix+"ace-show-invisibles-checkbox",function(){c.aceEditor.setShowInvisibles(this.checked),c.preferences.setItem("showinvisibles",this.checked)}),k.on("click",function(){j.popover("hide")}),k.on("click",".popover",function(a){a.stopPropagation()}),j.on("click",function(a){j.popover("toggle"),a.stopPropagation()})}var b=0;return a.prototype.setTheme=function(a){this.aceEditor.setTheme("ace/theme/"+a)},a.prototype.getText=function(){return this.aceEditor.getSession().getValue()},a.prototype.setText=function(a){return this.aceEditor.getSession().setValue(a)},a.prototype.setFontSize=function(a){document.getElementById(this.editorDivId).style.fontSize=a},a.prototype.setMode=function(a){this.aceEditor.getSession().setMode("ace/mode/"+a)},a.prototype.setAnnotations=function(a){this.aceEditor.getSession().setAnnotations(a)},a.prototype.setTokenHighlighter=function(a,b){var c=new TokenHighlighter(this,a,b);this.tokenHiglighter=c},a.prototype.resize=function(a){var b=this;a=a||200,window.setTimeout(function(){$("#"+b.editorDivId).height($("#code-container").height()-$("#editor-tabs-bar").height()-$("#editor-opts-container").height()-$("#compile-opts-container").height()-2),b.aceEditor.resize()},a)},a.prototype.addKeyboardCommand=function(a,b,c,d){d="undefined"==typeof d?!0:!!d,this.aceEditor.commands.addCommand({name:a,bindKey:b,exec:c,readOnly:d})},a.prototype.autoIndentCode=function(){var a,b,c,d,e=this.aceEditor,f=e.getCursorPosition(),g=e.getSession(),h=g.getDocument(),i=g.getMode(),j=g.getLength();for(this.reIndenting=!0,a=0;j>a;a++)0!==a&&(b=i.getNextLineIndent(g.getState(a-1),g.getLine(a-1),g.getTabString()),c=g.getLine(a),d=/^\s*/.exec(c)[0],d!==b&&(c=b+c.trim()),h.insertLines(a,[c]),h.removeLines(a+1,a+1),i.autoOutdent(g.getState(a),g,a));e.moveCursorToPosition(f),e.clearSelection(),this.reIndenting=!1},a}(),window.GccOutputParser=function(){"use strict";function a(){}var b=/(.+?):\s*(.+)\s*:\s*(.+)\s*/,c=/(\d+):(\d+):\s*(.+)/,d=/\s*(.+)\s*:\s*(.+)\s*/,e={"program.c":"compile",gcc:"gcc",cc1:"gcc",collect2:"linker"};return a.prototype.parse=function(a){var f,g,h,i,j,k,l,m=[];return a.split("\n").forEach(function(a){f=b.exec(a),f&&(g=c.exec(f[2]),g?(i=g[1],j=g[2],h=d.exec(g[3]),h?(k=h[1],l=h[2]+": "+f[3]):(k=g[3],l=f[3])):(i=j=0,h=d.exec(f[2]),h?(k=h[1],l=h[2]+": "+f[3]):(k=f[2],l=f[3])),m.push({row:i,column:j,type:e[f[1]],gccErrorType:k,text:l}))}),m},a}(),require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a,b,c){function d(a){var b=a.split(/[:;,]/),c=b[1],d="base64"==b[2]?atob:decodeURIComponent,e=d(b.pop()),f=e.length,g=0,h=new Uint8Array(f);for(g;f>g;++g)h[g]=e.charCodeAt(g);return new m([h],{type:c})}function e(a,b){if("download"in k)return k.href=a,k.setAttribute("download",p),k.innerHTML="downloading...",j.body.appendChild(k),setTimeout(function(){k.click(),j.body.removeChild(k),b===!0&&setTimeout(function(){f.URL.revokeObjectURL(k.href)},250)},66),!0;if("undefined"!=typeof safari)return a="data:"+a.replace(/^data:([\w\/\-\+]+)/,g),window.open(a)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=a),!0;var c=j.createElement("iframe");j.body.appendChild(c),b||(a="data:"+a.replace(/^data:([\w\/\-\+]+)/,g)),c.src=a,setTimeout(function(){j.body.removeChild(c)},333)}var f=window,g="application/octet-stream",h=c||g,i=a,j=document,k=j.createElement("a"),l=function(a){return String(a)},m=f.Blob||f.MozBlob||f.WebKitBlob||l;m=m.call?m.bind(f):Blob;var n,o,p=b||"download";if("true"===String(this)&&(i=[i,h],h=i[0],i=i[1]),String(i).match(/^data\:[\w+\-]+\/[\w+\-]+[,;]/))return navigator.msSaveBlob?navigator.msSaveBlob(d(i),p):e(i);if(n=i instanceof m?i:new m([i],{type:h}),navigator.msSaveBlob)return navigator.msSaveBlob(n,p);if(f.URL)e(f.URL.createObjectURL(n),!0);else{if("string"==typeof n||n.constructor===l)try{return e("data:"+h+";base64,"+f.btoa(n))}catch(q){return e("data:"+h+","+encodeURIComponent(n))}o=new FileReader,o.onload=function(){e(this.result)},o.readAsDataURL(n)}return!0}b.exports=c},{}],2:[function(a,b){"use strict";function c(){this.stream=new Uint8Array(5),this.ofs=0,this.Put=function(a){switch(this.stream[this.ofs]=a,this.ofs++,this.ofs){case 1:if(this.stream[0]<128)return this.ofs=0,this.stream[0];break;case 2:if(192==(224&this.stream[0])&&128==(192&this.stream[1]))return this.ofs=0,(31&this.stream[0])<<6|(63&this.stream[1])<<0;break;case 3:if(224==(240&this.stream[0])&&128==(192&this.stream[1])&&128==(192&this.stream[2]))return this.ofs=0,(15&this.stream[0])<<12|(63&this.stream[1])<<6|(63&this.stream[2])<<0;break;case 4:return 240==(248&this.stream[0])&&128==(192&this.stream[1])&&128==(192&this.stream[2])&&128==(192&this.stream[3])?(this.ofs=0,(7&this.stream[0])<<18|(63&this.stream[1])<<12|(63&this.stream[2])<<6|(63&this.stream[3])<<0):(this.ofs=0,-1);default:return this.ofs=0,-1}return-1}}function d(a){return a=0|a,128>a?[a]:2047>=a?[a>>6|192,63&a|128]:65535>=a?[a>>12|224,a>>6&63|128,63&a|128]:1114111>=a?[a>>18|240,a>>12&63|128,a>>6&63|128,63&a|128]:[]}function e(a){for(var b=0,c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=1:2047>=d?b+=2:65535>=d?b+=3:1114111>=d&&(b+=4)}return b}b.exports.UTF8StreamToUnicode=c,b.exports.UTF8Length=e,b.exports.UnicodeToUTF8Stream=d},{}],3:[function(a,b){function c(a){this.url=a,this.onmessage=function(){},this.OpenSocket()}function d(a){a.data instanceof ArrayBuffer?this.onmessage(a):0==a.data.toString().indexOf("ping:")&&this.socket.send("pong:"+a.data.toString().substring(5))}function e(){g.Debug("Websocket closed. Reopening."),this.OpenSocket()}function f(a){g.Debug("Websocket error:"),g.Debug(a)}var g=a("../messagehandler");c.prototype.OpenSocket=function(){this.url?(this.socket=new WebSocket(this.url),this.socket.binaryType="arraybuffer",this.socket.onmessage=d.bind(this),this.socket.onclose=e.bind(this),this.socket.onerror=f.bind(this)):this.socket={send:function(){}}},c.prototype.SendFrame=function(a){this.socket.send(a)},c.prototype.Close=function(){this.socket.onclose=void 0,this.socket.close()},b.exports=c},{"../messagehandler":9}],4:[function(a,b){function c(){}var d=a("../messagehandler.js"),e=a("../../lib/download");c.prototype.TAR=function(a){d.Register("tar",function(a){e(a,"user.tar","application/x-tar")}),d.Send("tar",a)},c.prototype.Sync=function(a){d.Register("sync",this.OnSync.bind(this)),d.Send("sync",a)},c.prototype.OnSync=function(a){utils.UploadBinaryResource(this.params.syncURL,this.params.userid+".tar",a,function(a){alert("Message from Server:"+a+"\nThe home folder '/home/user' has been synced with the server\nIn order to access the data at a later date,\nstart the next session with the current url with the user id\nThe folder size is currently limited to 1MB. Note that the feature is experimental.\nThe content can be downloaded under http://jor1k.com/sync/tarballs/"+this.params.userid+".tar.bz2")}.bind(this),function(a){alert(a)})},c.prototype.UploadExternalFile=function(a){var b=new FileReader;b.onload=function(){d.Send("MergeFile",{name:"home/user/"+a.name,data:new Uint8Array(b.result)})}.bind(this),b.readAsArrayBuffer(a)},c.prototype.MergeFile=function(a,b){function c(a){for(var b=a.split(""),c=[],d=0;d<b.length;d++)c.push(b[d].charCodeAt(0));return new Uint8Array(c)}d.Send("MergeFile",{name:a,data:c(b)})},c.prototype.ReadFile=function(a,b){d.Register("ReadFile",b),d.Send("ReadFile",{name:a})},c.prototype.WatchFile=function(a,b){d.Register("WatchFileEvent",b),d.Send("WatchFile",{name:a})},b.exports=c},{"../../lib/download":1,"../messagehandler.js":9}],5:[function(a,b){function c(a,b){this.fbid=a,this.Init(a),this.SetFPS(b)}var d=a("../messagehandler.js");c.prototype.Init=function(a){this.fbcanvas=document.getElementById(a),this.fbcanvas&&(this.fbctx=this.fbcanvas.getContext("2d"),this.fbctx.fillStyle="rgba(0, 0, 0, 255)",this.fbctx.fillRect(0,0,this.fbcanvas.width,this.fbcanvas.height),this.fbimageData=this.fbctx.createImageData(this.fbcanvas.width,this.fbcanvas.height),this.fbcanvas.onmousedown=function(a){this.fbcanvas.style.border="2px solid #FF0000";var b=this.fbcanvas.getBoundingClientRect(),c=640*(a.clientX-b.left)/b.width,e=400*(a.clientY-b.top)/b.height;d.Send("tsmousedown",{x:c,y:e})}.bind(this),this.fbcanvas.onmouseup=function(a){var b=this.fbcanvas.getBoundingClientRect(),c=640*(a.clientX-b.left)/b.width,e=400*(a.clientY-b.top)/b.height;d.Send("tsmouseup",{x:c,y:e})}.bind(this),this.fbcanvas.onmousemove=function(a){var b=this.fbcanvas.getBoundingClientRect(),c=640*(a.clientX-b.left)/b.width,e=400*(a.clientY-b.top)/b.height;d.Send("tsmousemove",{x:c,y:e})}.bind(this))},c.prototype.SetFPS=function(a){this.fps=a,this.fbcanvas&&(this.fbinterval&&window.clearInterval(this.fbinterval),0!=a&&(this.fbinterval=window.setInterval(function(){d.Send("GetFB",0)}.bind(this),1e3/this.fps)))},c.prototype.Update=function(a){if(this.fbcanvas){var b=0,c=a.length,d=this.fbimageData.data,e=0;for(b=0;c>b;b++){var f=a[b];d[e++]=f>>24&248,d[e++]=f>>19&252,d[e++]=f>>13&248,d[e++]=255,d[e++]=f>>8&248,d[e++]=f>>3&252,d[e++]=f<<3&248,d[e++]=255}this.fbctx.putImageData(this.fbimageData,0,0)}},b.exports=c},{"../messagehandler.js":9}],6:[function(a,b){function c(a){this.enabled=!1,this.nperiods=8,this.source=new Array(this.nperiods),this.soundbuffer=new Array(this.nperiods),this.period=0,this.periodsize=0,this.bufferpos=0,"undefined"!=typeof AudioContext&&(this.context=new AudioContext,this.SetRate(a))}a("../messagehandler");c.prototype.SetRate=function(a){if(this.samplerate!=a){this.samplerate=a,this.periodsize=Math.floor(this.samplerate/4),this.sampleslen=this.periodsize*this.nperiods,this.buffer=new Float32Array(this.sampleslen);for(var b=0;b<this.nperiods;b++)this.soundbuffer[b]=this.context.createBuffer(1,this.periodsize,this.samplerate)}},c.prototype.OnEnded=function(){this.enabled&&(this.PlayBuffer(this.period),this.period++)},c.prototype.Enabled=function(a){this.enabled=a,a&&(this.period=0,this.basetime=this.context.currentTime,this.PlayBuffer(0),this.PlayBuffer(1),this.period=2,this.bufferpos=this.periodsize*(this.period+4))},c.prototype.PlayBuffer=function(a){if(this.enabled){for(var b=a%this.nperiods,c=this.soundbuffer[b].getChannelData(0),d=b*this.periodsize,e=0;e<this.periodsize;e++)c[e]=this.buffer[e+d],this.buffer[e+d]=0;var f=this.context.createBufferSource();f.buffer=this.soundbuffer[b],f.connect(this.context.destination),f.onended=this.OnEnded.bind(this),f.start(this.basetime+a*this.periodsize/this.samplerate),this.source[b]=f}},c.prototype.AddBuffer=function(a){if(this.enabled){var b=this.bufferpos/this.periodsize;b<this.period+2&&(this.bufferpos=this.periodsize*(this.period+4)),b>this.period+5&&(this.bufferpos=this.periodsize*(this.period+4));for(var c=0;c<a.length;c++)this.buffer[this.bufferpos%this.sampleslen]=a[c]/128,this.bufferpos++}},b.exports=c},{"../messagehandler":9}],7:[function(a,b){"use strict";function c(a){this.CTRLpressed=!1,this.ALTpressed=!1,this.SendChars=a,this.enabled=!0}var d=a("../../lib/utf8");c.prototype.OnKeyPress=function(a){if(this.enabled){var b=0;return b=a.charCode,0==b?!1:(this.CTRLpressed&&(b>=65&&90>=b||b>=97&&122>=b)&&(b&=31),this.SendChars(d.UnicodeToUTF8Stream(b)),!1)}},c.prototype.OnKeyUp=function(a){if(this.enabled){{var b=a.keyCode;a.charCode}return 17==b?this.CTRLpressed=!1:18==b&&(this.ALTpressed=!1),!1}},c.prototype.OnKeyDown=function(a){if(this.enabled){{var b=a.keyCode;a.charCode}if(this.CTRLpressed&&!this.ALTpressed&&b>=65&&90>=b)return this.SendChars([b-32&31]),a.preventDefault(),!1;switch(b){case 8:return this.SendChars([127]),a.preventDefault(),!1;case 9:break;case 16:return;case 38:return this.SendChars([27,91,65]),a.preventDefault(),!1;case 37:return this.SendChars([27,91,68]),a.preventDefault(),!1;case 39:return this.SendChars([27,91,67]),a.preventDefault(),!1;case 40:return this.SendChars([27,91,66]),a.preventDefault(),!1;case 112:case 113:case 114:case 115:case 116:return this.SendChars([27,91,91,b-112+65]),a.preventDefault(),!1;case 117:case 118:case 119:return this.SendChars([27,91,49,b-117+55,126]),a.preventDefault(),!1;case 120:case 121:return this.SendChars([27,91,50,b-120+48,126]),a.preventDefault(),!1;case 36:return this.SendChars([27,91,72]),a.preventDefault(),!1;case 35:return this.SendChars([27,91,70]),a.preventDefault(),!1;case 33:return this.SendChars([27,91,53,126]),a.preventDefault(),!1;case 34:return this.SendChars([27,91,54,126]),a.preventDefault(),!1;case 45:return this.SendChars([27,91,50,126]),a.preventDefault(),!1;case 46:return this.SendChars([27,91,51,126]),a.preventDefault(),!1;case 17:return void(this.CTRLpressed=!0);case 18:return void(this.ALTpressed=!0)}return 0!=b&&31>=b?(this.SendChars([b]),a.preventDefault(),!1):void 0}},b.exports=c},{"../../lib/utf8":2}],8:[function(a,b){"use strict";function c(a,b,c){this.nrows=a,this.ncolumns=b;var e=document.getElementById(c);if("CANVAS"==e.tagName)this.canvas=e,this.context=this.canvas.getContext("2d"),this.context.font="13px courier,fixed,swiss,monospace,sans-serif";else{this.Table=e,this.rowelements=new Array(this.nrows);for(var f=0;a>f;f++){var g=this.Table.insertRow(0),h=document.createElement("td");this.rowelements[f]=h,g.appendChild(h)}}this.cursorvisible=!1,this.escapetype=0,this.escapestring="",this.cursorx=0,this.cursory=0,this.scrolltop=0,this.cursortype=1,this.scrollbottom=this.nrows-1,this.attr_color=7,this.attr_reverse=!1,this.attr_italic=!1,this.attr_intensity=1,this.pauseblink=!1,this.OnCharReceived=function(){},this.framerequested=!1,this.timeout=30,this.updaterow=new Uint8Array(this.nrows),this.utf8converter=new d.UTF8StreamToUnicode,this.screen=new Array(this.nrows),this.color=new Array(this.nrows);for(var f=0;f<this.nrows;f++){this.updaterow[f]=1,this.screen[f]=new Uint16Array(this.ncolumns),this.color[f]=new Uint16Array(this.ncolumns);for(var i=0;i<this.ncolumns;i++)this.screen[f][i]=32,this.color[f][i]=this.attr_color}this.UpdateScreen(),this.Blink()}var d=a("../../lib/utf8"),e=a("../messagehandler"),f=new Array("#000000","#BB0000","#00BB00","#BBBB00","#0000BB","#BB00BB","#00BBBB","#BBBBBB","#555555","#FF5555","#55FF55","#FFFF55","#5555FF","#FF55FF","#55FFFF","#FFFFFF","#000000","#770000","#007700","#777700","#000077","#770077","#007777","#777777");c.prototype.PauseBlink=function(a){a=!!a,this.pauseblink=a,this.cursortype&&(this.cursorvisible=!a),this.PrepareUpdateRow(this.cursory,this.cursorx)},c.prototype.GetColor=function(){var a=this.attr_color;return this.attr_reverse&&(a=(7&a)<<8|a>>8&7),2==this.attr_intensity?a=8|a:0==this.attr_intensity&&(a=16|a),a},c.prototype.Blink=function(){this.cursorvisible=!this.cursorvisible,this.pauseblink||this.PrepareUpdateRow(this.cursory,this.cursorx),window.setTimeout(this.Blink.bind(this),500)},c.prototype.DeleteRow=function(a){for(var b=0;b<this.ncolumns;b++)this.screen[a][b]=32,this.color[a][b]=this.attr_color;this.PrepareUpdateRow(a)},c.prototype.DeleteArea=function(a,b,c,d){for(var e=a;c>=e;e++){for(var f=b;d>=f;f++)this.screen[e][f]=32,this.color[e][f]=this.attr_color;this.PrepareUpdateRow(e)}},c.prototype.UpdateRowCanvas=function(a){for(var b=a<<4,c=this.screen[a],d=0|this.color[a][0],e=0,g=0;g<this.ncolumns;g++){var h=0|this.color[a][g];if(this.cursorvisible&&a==this.cursory&&g==this.cursorx&&(h|=1536),d!=h){var i=g-e<<3;this.context.fillStyle=f[d>>>8&31],this.context.fillRect(i,b,8*e,16),this.context.fillStyle=f[31&d];for(var j=0;e>j;j++)this.context.fillText(String.fromCharCode(c[g-e+j]),i+(j<<3),b+12);d=h,e=0}e++}var i=g-e<<3;this.context.fillStyle=f[d>>>8&31],this.context.fillRect(i,b,8*e,16),this.context.fillStyle=f[31&d];for(var j=0;e>j;j++)this.context.fillText(String.fromCharCode(c[g-e+j]),i+(j<<3),b+12)},c.prototype.GetSpan=function(a,b,c,d){for(var e='<span style="color:'+f[31&a]+";background-color:"+f[a>>8&31]+'">',g=0;d>g;g++)switch(b[c+g]){case 32:e+="&nbsp;";break;case 38:e+="&amp;";break;case 60:e+="&lt;";break;case 62:e+="&gt;";break;default:e+=String.fromCharCode(b[c+g])}return e+="</span>"},c.prototype.UpdateRowTable=function(a){for(var b=this.screen[a],c=0|this.color[a][0],d=0,e="",f=0;f<this.ncolumns;f++){var g=0|this.color[a][f];this.cursorvisible&&a==this.cursory&&f==this.cursorx&&(g|=1536),c!=g&&(e+=this.GetSpan(c,b,f-d,d),c=g,d=0),d++}e+=this.GetSpan(c,b,f-d,d),this.rowelements[this.nrows-a-1].innerHTML=e},c.prototype.UpdateScreen=function(){for(var a=0,b=0;b<this.nrows;b++)this.updaterow[b]&&(this.canvas?this.UpdateRowCanvas(b):this.UpdateRowTable(b),a++,this.updaterow[b]=0);this.framerequested=!1,this.timeout=a>=this.nrows-1?100:30},c.prototype.PrepareUpdateRow=function(a){this.updaterow[a]=1,this.framerequested||(this.timeout<=30?window.requestAnimationFrame(this.UpdateScreen.bind(this)):window.setTimeout(this.UpdateScreen.bind(this),this.timeout),this.framerequested=!0)},c.prototype.ScrollDown=function(a){for(var b=this.screen[this.scrollbottom],c=this.color[this.scrollbottom],d=this.scrollbottom-1;d>=this.scrolltop;d--)d!=this.nrows-1&&(this.screen[d+1]=this.screen[d],this.color[d+1]=this.color[d],a&&this.PrepareUpdateRow(d+1));this.screen[this.scrolltop]=b,this.color[this.scrolltop]=c,this.DeleteRow(this.scrolltop),a&&this.PrepareUpdateRow(this.scrolltop)},c.prototype.ScrollUp=function(a){for(var b=this.screen[this.scrolltop],c=this.color[this.scrolltop],d=this.scrolltop+1;d<=this.scrollbottom;d++)0!=d&&(this.screen[d-1]=this.screen[d],this.color[d-1]=this.color[d],a&&this.PrepareUpdateRow(d-1));this.screen[this.scrollbottom]=b,this.color[this.scrollbottom]=c,this.DeleteRow(this.scrollbottom),a&&this.PrepareUpdateRow(this.scrollbottom)},c.prototype.LineFeed=function(){return this.cursory!=this.scrollbottom?(this.cursory++,void(this.cursorvisible&&(this.PrepareUpdateRow(this.cursory-1),this.PrepareUpdateRow(this.cursory)))):void this.ScrollUp(!0)},c.prototype.ChangeCursor=function(a){switch(a.length){case 0:this.cursorx=0,this.cursory=0;break;case 1:this.cursory=a[0],this.cursory&&this.cursory--;break;case 2:default:this.cursory=a[0],this.cursorx=a[1],this.cursorx&&this.cursorx--,this.cursory&&this.cursory--}this.cursorx>=this.ncolumns&&(this.cursorx=this.ncolumns-1),this.cursory>=this.nrows&&(this.cursory=this.nrows-1)},c.prototype.ChangeColor=function(a){if(0==a.length)return this.attr_color=7,this.attr_reverse=!1,this.attr_italic=!1,void(this.attr_intensity=1);for(var b=this.attr_color,c=0;c<a.length;c++)switch(Number(a[c])){case 0:b=7,this.attr_reverse=!1,this.attr_italic=!1,this.attr_intensity=1;break;case 1:this.attr_intensity=2;break;case 2:this.attr_intensity=0;break;case 3:this.attr_italic=!0;break;case 4:break;case 5:break;case 7:this.attr_reverse=!0;break;case 8:break;case 10:break;case 21:case 22:this.attr_intensity=1;break;case 23:this.attr_italic=!1;break;case 27:this.attr_reverse=!1;break;case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:b=65528&b|a[c]-30&7;break;case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:b=255&b|(a[c]-40&7)<<8;break;case 39:b=65280&b|7;break;case 49:b=255&b;break;default:e.Warning("Color "+a[c]+" not found")}this.attr_color=0|b},c.prototype.ChangeMode=function(a,b,c){for(var d=0;d<a.length;d++)switch(a[d]){case 4:break;case 7:break;case 25:this.cursortype=c;

break;case 1e3:break;case 1006:break;case 1005:break;default:e.Warning("Mode term parameter "+this.escapestring+" unknown")}},c.prototype.ChangeCursorType=function(a,b){if(!b)return void e.Warning("cursor parameter unknown");for(var c=0;c<a.length;c++)switch(a[c]){case 0:break;case 1:break;default:e.Warning("Term parameter "+this.escapestring+" unknown")}},c.prototype.HandleEscapeSequence=function(){var a=0;if("[J"==this.escapestring)return this.DeleteArea(this.cursory,this.cursorx,this.cursory,this.ncolumns-1),void this.DeleteArea(this.cursory+1,0,this.nrows-1,this.ncolumns-1);if("M"==this.escapestring)return void this.ScrollDown(!0);var b=this.escapestring;if("["!=b.charAt(0))return void e.Warning("Short escape sequence unknown:'"+this.escapestring+"'");b=b.substr(1);var c=b.substr(b.length-1);b=b.substr(0,b.length-1);var d=!1;"?"==b.charAt(0)&&(d=!0,b=b.substr(1));var f=b.split(";");for(0==f[0].length&&(f=[]),a=0;a<f.length;a++)f[a]=Number(f[a]);var g=this.cursory,h=0;switch(c){case"l":return void this.ChangeMode(f,d,!0);case"h":return void this.ChangeMode(f,d,!1);case"c":return void this.ChangeCursorType(f,d)}if(d)return void e.Warning("Escape sequence unknown:'"+this.escapestring+"'");switch(c){case"m":return void this.ChangeColor(f);case"A":h=f.length?f[0]:1,0==h&&(h=1),this.cursory-=h;break;case"B":h=f.length?f[0]:1,0==h&&(h=1),this.cursory+=h;break;case"C":h=f.length?f[0]:1,0==h&&(h=1),this.cursorx+=h;break;case"D":h=f.length?f[0]:1,0==h&&(h=1),this.cursorx-=h,this.cursorx<0&&(this.cursorx=0);break;case"E":h=f.length?f[0]:1,this.cursory+=h,this.cursorx=0;break;case"F":h=f.length?f[0]:1,this.cursory-=h,this.cursory<0&&(this.cursory=0),this.cursorx=0;break;case"G":h=f.length?f[0]:1,this.cursorx=h,this.cursorx&&this.cursorx--;break;case"H":case"d":case"f":this.ChangeCursor(f);break;case"K":h=f.length?f[0]:1,f.length?1==f[0]?this.DeleteArea(this.cursory,0,this.cursory,this.cursorx):2==f[0]&&this.DeleteRow(this.cursory):this.DeleteArea(this.cursory,this.cursorx,this.cursory,this.ncolumns-1);break;case"L":h=f.length?f[0]:1,0==h&&(h=1);var i=this.scrolltop;if(this.scrolltop=this.cursory,1==h)this.ScrollDown(!0);else{for(var j=0;h-1>j;j++)this.ScrollDown(!1);this.ScrollDown(!0)}this.scrolltop=i;break;case"M":h=f.length?f[0]:1,0==h&&(h=1);var i=this.scrolltop;if(this.scrolltop=this.cursory,1==h)this.ScrollUp(!0);else{for(var j=0;h-1>j;j++)this.ScrollUp(!1);this.ScrollUp(!0)}this.scrolltop=i;break;case"P":h=f.length?f[0]:1,0==h&&(h=1);for(var k=0,j=this.cursorx+h;j<this.ncolumns;j++)this.screen[this.cursory][this.cursorx+k]=this.screen[this.cursory][j],this.color[this.cursory][this.cursorx+k]=this.color[this.cursory][j],k++;this.DeleteArea(this.cursory,this.ncolumns-h,this.cursory,this.ncolumns-1),this.PrepareUpdateRow(this.cursory);break;case"r":return void(0==f.length?(this.scrolltop=0,this.scrollbottom=this.nrows-1):(this.scrolltop=f[0],this.scrollbottom=f[1],this.scrolltop&&this.scrolltop--,this.scrollbottom&&this.scrollbottom--));case"X":h=f.length?f[0]:1,0==h&&(h=1);for(var j=0;h>j;j++)this.screen[this.cursory][this.cursorx+j]=32,this.color[this.cursory][this.cursorx+j]=this.GetColor();this.PrepareUpdateRow(this.cursory);break;default:e.Warning("Escape sequence unknown:'"+this.escapestring+"'")}this.cursorvisible&&(this.PrepareUpdateRow(this.cursory),this.cursory!=g&&this.PrepareUpdateRow(g))},c.prototype.PutChar=function(a){if(2==this.escapetype)return this.escapestring+=String.fromCharCode(a),void(a>=64&&126>=a&&(this.HandleEscapeSequence(),this.escapetype=0));if(0==this.escapetype&&27==a)return this.escapetype=1,void(this.escapestring="");if(1==this.escapetype)return this.escapestring+=String.fromCharCode(a),91==a?void(this.escapetype=2):(this.HandleEscapeSequence(),void(this.escapetype=0));switch(a){case 10:return this.LineFeed(),void this.OnCharReceived("\n");case 13:return this.cursorx=0,void this.PrepareUpdateRow(this.cursory);case 7:return;case 8:return this.cursorx--,this.cursorx<0&&(this.cursorx=0),void this.PrepareUpdateRow(this.cursory);case 9:var b=8-(7&this.cursorx);do this.cursorx>=this.ncolumns&&(this.PrepareUpdateRow(this.cursory),this.LineFeed(),this.cursorx=0),this.screen[this.cursory][this.cursorx]=32,this.color[this.cursory][this.cursorx]=this.attr_color,this.cursorx++;while(b--);return void this.PrepareUpdateRow(this.cursory);case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 11:case 12:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 127:return void e.Warning("unknown character "+a)}if(this.cursorx>=this.ncolumns&&(this.LineFeed(),this.cursorx=0),a=this.utf8converter.Put(a),-1!=a){var c=this.cursorx,d=this.cursory;this.screen[d][c]=a,this.color[d][c]=this.GetColor(),this.cursorx++,this.PrepareUpdateRow(d),this.OnCharReceived(String.fromCharCode(a))}},b.exports=c},{"../../lib/utf8":2,"../messagehandler":9}],9:[function(a,b){"use strict";function c(a,b){k.postMessage({command:a,data:b})}function d(a){console.log(a)}function e(){throw d("Master: Abort execution."),l=!1,c("Abort",{}),new Error("Kill master")}function f(a){c("Debug","Error: "+a),e()}function g(a){c("Debug","Warning: "+a)}function h(a,b){m[a]=b}function i(a){var b=a.data.command;if("Debug"==b)return void m[b](a.data.data);if(l&&"function"==typeof m[b])try{m[b](a.data.data)}catch(c){d('Master: Unhandled exception in command "'+b+'": '+c.message),l=!1}}function j(a){k=a,k.onmessage=i,k.onerror=function(a){d("Error at "+a.filename+":"+a.lineno+": "+a.message),e()},h("Abort",function(){d("Master: Received abort signal from worker"),l=!1}),h("Debug",function(a){d(a)})}var k,l=!0,m=new Object;b.exports.SetWorker=j,b.exports.Register=h,b.exports.Debug=d,b.exports.Warning=g,b.exports.Error=f,b.exports.Abort=e,b.exports.Send=c},{}],10:[function(a,b){function c(a){this.params=a,this.message=i,this.params.system=this.params.system||{},this.params.path=this.params.path||"",this.params.system.kernelURL=this.params.system.kernelURL||"vmlinux.bin.bz2",this.params.system.memorysize=this.params.system.memorysize||32,this.params.system.cpu=this.params.system.cpu||"asm",this.params.system.ncores=this.params.system.ncores||1,this.params.fs=this.params.fs||{},this.params.fs.basefsURL=this.params.fs.basefsURL||"basefs.json",this.params.fs.earlyload=this.params.fs.earlyload||[],this.params.fs.lazyloadimages=this.params.fs.lazyloadimages||[],this.params.userid=this.params.userid||"",this.params.path=this.params.path||"",this.worker=new Worker(this.params.path+"../bin/jor1k-worker-min.js"),i.SetWorker(this.worker),this.params.clipboardid&&(this.clipboard=document.getElementById(this.params.clipboardid)),this.params.statsid&&(this.stats=document.getElementById(this.params.statsid)),this.params.fbid&&(this.framebuffer=new e(this.params.fbid,this.params.fps),i.Register("GetFB",this.framebuffer.Update.bind(this.framebuffer))),this.terms=[],this.params.term?this.terms=[this.params.term]:this.params.terms&&(this.terms=this.params.terms.slice(0,2));for(var b=0;b<this.terms.length;b++)this.terms[b].Init(this,"tty"+b);this.activeTTY="tty0",this.terminput=new d(this.SendChars.bind(this)),this.fs=new h,this.sound=new g(22050),i.Register("sound",this.sound.AddBuffer.bind(this.sound)),i.Register("sound.rate",this.sound.SetRate.bind(this.sound)),this.clipboard&&(this.clipboard.onpaste=function(){this.clipboard.value="",setTimeout(this.SendClipboard.bind(this),4)}.bind(this),this.SendClipboard=function(){for(var a=[],b=this.clipboard.value,c=0;c<b.length;c++)a.push(b.charCodeAt(c));this.SendChars(a),this.clipboard.value=""}.bind(this)),this.IgnoreKeys=function(){return this.lastMouseDownTarget!=j&&(this.framebuffer?this.lastMouseDownTarget!=this.framebuffer.fbcanvas:!0)&&this.lastMouseDownTarget!=this.clipboard};var c=function(a){for(var b=!1,c=0;c<this.terms.length;c++)if(this.terms[c].WasHitByEvent(a)){b=!0,this.activeTTY="tty"+c;break}this.lastMouseDownTarget=b?j:a.target}.bind(this);document.addEventListener?document.addEventListener("mousedown",c,!1):Window.onmousedown=c,document.onkeypress=function(a){return this.IgnoreKeys()?!0:this.lastMouseDownTarget==j||this.lastMouseDownTarget==this.clipboard?this.terminput.OnKeyPress(a):(i.Send("keypress",{keyCode:a.keyCode,charCode:a.charCode}),!1)}.bind(this),document.onkeydown=function(a){return this.IgnoreKeys()?!0:this.lastMouseDownTarget==j||this.lastMouseDownTarget==this.clipboard?this.terminput.OnKeyDown(a):(i.Send("keydown",{keyCode:a.keyCode,charCode:a.charCode}),!1)}.bind(this),document.onkeyup=function(a){return this.IgnoreKeys()?!0:this.lastMouseDownTarget==j||this.lastMouseDownTarget==this.clipboard?this.terminput.OnKeyUp(a):(i.Send("keyup",{keyCode:a.keyCode,charCode:a.charCode}),!1)}.bind(this),this.params.relayURL&&(this.ethernet=new f(this.params.relayURL),this.ethernet.onmessage=function(a){i.Send("ethmac",a.data)}.bind(this),i.Register("ethmac",this.ethernet.SendFrame.bind(this.ethernet))),i.Register("GetIPS",this.ShowIPS.bind(this)),i.Register("execute",this.Execute.bind(this)),this.Reset(),window.setInterval(function(){i.Send("GetIPS",0)}.bind(this),1e3)}var d=(a("./dev/terminal"),a("./dev/terminal-input")),e=a("./dev/framebuffer"),f=a("./dev/ethernet"),g=a("./dev/sound"),h=a("./dev/filesystem"),i=(a("./utils"),a("./messagehandler")),j=3735928559;c.prototype.Execute=function(){this.stop||(this.userpaused?this.executepending=!0:(this.executepending=!1,i.Send("execute",0)))},c.prototype.ShowIPS=function(a){this.stats&&(this.stats.innerHTML=this.userpaused?"Paused":1e6>a?Math.floor(a/1e3)+" KIPS":Math.floor(a/1e5)/10+" MIPS")},c.prototype.ChangeCore=function(a){i.Send("ChangeCore",a)},c.prototype.Reset=function(){this.stop=!1,this.userpaused=!1,this.executepending=!1,i.Send("Init",this.params.system),i.Send("Reset"),i.Send("LoadAndStart",this.params.system.kernelURL),i.Send("LoadFilesystem",this.params.fs),this.terms.length>0&&(this.terms.forEach(function(a){a.PauseBlink(!1)}),this.lastMouseDownTarget=j)},c.prototype.Pause=function(a){a=!!a,a!=this.userpaused&&(this.userpaused=a,!this.userpaused&&this.executepending&&(this.executepending=!1,i.Send("execute",0)),this.terms.forEach(function(b){b.PauseBlink(a)}))},c.prototype.SendChars=function(a){this.lastMouseDownTarget!=this.fbcanvas&&i.Send(this.activeTTY,a)},c.prototype.GetTerm=function(a){var b=parseInt(a.slice(3));return this.terms[b]},c.prototype.FocusTerm=function(a){this.activeTTY=a,this.lastMouseDownTarget=j},b.exports=c},{"./dev/ethernet":3,"./dev/filesystem":4,"./dev/framebuffer":5,"./dev/sound":6,"./dev/terminal":8,"./dev/terminal-input":7,"./messagehandler":9,"./utils":11}],11:[function(a,b){"use strict";function c(a,b,c,d,e){var f="xxxxxxxxx",g=new XMLHttpRequest;g.open("post",a,!0),g.setRequestHeader("Content-Type","multipart/form-data, boundary="+f),g.setRequestHeader("Content-Length",c.length),g.onreadystatechange=function(){return 4==g.readyState?200!=g.status&&0!=g.status?void e("Error: Could not upload file "+b):void d(this.responseText):void 0};var h="--"+f+"\r\n";h+='Content-Disposition: form-data; name="uploaded"; filename="'+b+'"\r\n',h+="Content-Type: application/octet-stream\r\n\r\n";var i="\r\n";i+="--"+f+"--";for(var j=new Uint8Array(c.length+h.length+i.length),k=0,l=0;l<h.length;l++)j[k++]=h.charCodeAt(l);for(var l=0;l<c.length;l++)j[k++]=c[l];for(var l=0;l<i.length;l++)j[k++]=i.charCodeAt(l);g.send(j.buffer)}b.exports.UploadBinaryResource=c},{}],Jor1k:[function(a,b){var c=a("./system");b.exports=c},{"./system":10}],MackeTerm:[function(a,b){function c(a){this.termElementId=a}var d=a("../master/dev/terminal");c.prototype.Init=function(a,b){this.term=new d(24,80,this.termElementId),a.message.Register(b,function(a){a.forEach(function(a){this.term.PutChar(255&a)}.bind(this))}.bind(this)),this.terminalcanvas=document.getElementById(this.termElementId),this.terminalcanvas.onmousedown=function(){a.framebuffer&&(a.framebuffer.fbcanvas.style.border="2px solid #000000")}.bind(this)},c.prototype.WasHitByEvent=function(a){return this.terminalcanvas.contains(a.target)},c.prototype.PauseBlink=function(a){this.term.PauseBlink(a)},c.prototype.SetCharReceiveListener=function(a){this.term.OnCharReceived=a},c.prototype.RemoveCharReceiveListener=function(){this.term.OnCharReceived=function(){}},b.exports=c},{"../master/dev/terminal":8}]},{},[]),window.LiveEdit=function(){"use strict";function a(a,b){this.runtime=b,this.editor=a,this.viewModel=SysViewModel.getInstance();var c=function(){var a=this.runtime.ready();this.viewModel.vmState(a?"Running":"Booting"),this.viewModel.compileStatus(a?"Ready":"Waiting")}.bind(this);c(),this.runtime.addListener("ready",function(){c()}.bind(this))}return a.prototype.escapeHtml=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},a.prototype.processGccCompletion=function(a){if(this.viewModel.gccErrorCount(0),this.viewModel.gccWarningCount(0),!a)return void this.viewModel.compileStatus("Cancelled");this.runtime.sendKeys("tty0","clear\n");var b=[],c=[];a.annotations.forEach(function(a){a.isGccOptsError?c.push(a):b.push(a)}),this.editor.setAnnotations(b),this.viewModel.lastGccOutput(a.gccOutput),this.viewModel.gccErrorCount(a.stats.error),this.viewModel.gccWarningCount(a.stats.warning),this.viewModel.gccOptsError(c.map(function(a){return a.text}).join("\n")),0===a.exitCode?(this.viewModel.compileStatus(a.stats.warning>0?"Warning":"Success"),this.runtime.startProgram("program",this.viewModel.programArgs())):this.viewModel.compileStatus("Failed")},a.prototype.runCode=function(a,b){if(!(0===a.length||a.indexOf("")>=0||a.indexOf("")>=0)){var c=this.processGccCompletion.bind(this);this.viewModel.compileStatus("Compiling"),this.runtime.startGccCompile(a,b,c)}},a}(),window.SysRuntime=function(){"use strict";function a(){this.bootFinished=!1,this.tty0ready=!1,this.tty1ready=!1,this.listeners={},this.ttyState=this.BOOT,this.ttyOutput="",this.captureOutput=!1,this.compileTicket=0,this.gccOutputCaptureRe=/###GCC_COMPILE###\s*([\S\s]*?)\s*###GCC_COMPILE_FINISHED###/,this.gccExitCodeCaptureRe=/GCC_EXIT_CODE: (\d+)/,this.putCharTTY0Listener=function(a){this.captureOutput&&(this.ttyOutput+=a),this.notifyListeners("putchar-tty0",a)}.bind(this),this.putCharTTY1Listener=function(a){this.notifyListeners("putchar-tty1",a)}.bind(this);var a=function(){this.tty0ready&&this.tty1ready&&(this.bootFinished=!0,this.notifyListeners("ready",!0))}.bind(this),b=function(b){this.tty0ready=b,a()}.bind(this),c=function(b){this.tty1ready=b,a()}.bind(this),d=function(a){a&&this.sendKeys("tty1","login -f user\n","~ $",c)}.bind(this),e=function(a){a&&this.sendKeys("tty0","stty -clocal crtscts -ixoff\necho boot2ready-$?\n","boot2ready-0",b)}.bind(this),f=function(a){a&&this.sendKeys("tty1","stty -clocal crtscts -ixoff\necho boot2ready-$?\n","boot2ready-0",d)}.bind(this),g=require("MackeTerm"),h=require("Jor1k"),i=new g("tty0"),j=new g("tty1"),k={system:{kernelURL:"vmlinux.bin.bz2",memorysize:32,cpu:"asm",ncores:1},fs:{basefsURL:"basefs-compile.json",extendedfsURL:"http://cs-education.github.io/sysassets/jor1kfs/sysroot/fs.json",earlyload:["usr/bin/gcc","usr/libexec/gcc/or1k-linux-musl/4.9.0/cc1","usr/libexec/gcc/or1k-linux-musl/4.9.0/collect2","usr/lib/libbfd-2.24.51.20140817.so","usr/lib/gcc/or1k-linux-musl/4.9.0/libgcc.a","usr/bin/as","usr/include/stdio.h"],lazyloadimages:[]},terms:[i,j],statsid:"vm-stats",memorysize:32,path:"../jor1k/bin/"};return this.jor1kgui=new h(k),i.SetCharReceiveListener(this.putCharTTY0Listener),j.SetCharReceiveListener(this.putCharTTY1Listener),this.sendKeys("tty0","","~ $",e),this.sendKeys("tty1","","~ #",f),this}a.prototype.ready=function(){return this.bootFinished},a.prototype.focusTerm=function(a){this.jor1kgui.FocusTerm(a)},a.prototype.startGccCompile=function(a,b,c){if(!this.bootFinished)return 0;this.expecting&&this.expecting.cancel(),this.ttyOutput="",this.captureOutput=!0,++this.compileTicket;var d=function(a){var b=null;if(this.expecting=void 0,a){this.captureOutput=!1;var d=this.gccOutputCaptureRe.exec(this.ttyOutput),e=d[1],f=parseInt(this.gccExitCodeCaptureRe.exec(e)[1]);this.ttyOutput="";var g={error:0,warning:0,info:0},h=this.getErrorAnnotations(e);h.forEach(function(a){g[a.type]+=1}),b={exitCode:f,stats:g,annotations:h,gccOutput:e}}c(b)}.bind(this);this.sendKeys("tty0","\ncd ~;rm program.c program 2>/dev/null\n"),this.sendTextFile("program.c",a);var e="echo \\#\\#\\#GCC_COMPILE\\#\\#\\#;clear;gcc "+b+" program.c -o program; echo GCC_EXIT_CODE: $?; echo \\#\\#\\#GCC_COMPILE_FINISHED\\#\\#\\#"+this.compileTicket+".;clear\n";return this.expecting=this.sendKeys("tty0",e,"GCC_COMPILE_FINISHED###"+this.compileTicket+".",d),this.compileTicket},a.prototype.getErrorAnnotations=function(a){var b=(new GccOutputParser).parse(a);return b.map(function(a){var b;return b=-1!==a.gccErrorType.toLowerCase().indexOf("error")?"error":-1!==a.gccErrorType.toLowerCase().indexOf("warning")?"warning":"info","undefined"==typeof a.type&&(a.row=a.col=-1),{row:a.row-1,col:a.col,isGccOptsError:"gcc"===a.type,type:b,text:a.text}})},a.prototype.startProgram=function(a,b){a&&("/"!==a[0]&&"."!==a[0]&&(a="./"+a.replace(" ","\\ ")),b=b.replace("\\","\\\\").replace("\n","\\n"),this.sendKeys("tty0","\n"+a+" "+b+"\n"))},a.prototype.sendTextFile=function(a,b){this.sendKeys("tty0","\nstty raw\ndd ibs=1 of="+a+" count="+b.length+"\n"+b+"\nstty -raw\n")},a.prototype.addListener=function(a,b){var c=this.listeners[a];c?c.push(b):this.listeners[a]=[b]},a.prototype.removeListener=function(a,b){var c=this.listeners[a];this.listeners[a]=c.filter(function(a){return a!==b})},a.prototype.notifyListeners=function(a,b){var c=this.listeners[a];if(c){c=c.slice();for(var d=0;c&&d<c.length;d++)c[d](this,b)}},a.prototype.sendKeys=function(a,b,c,d,e){var f=null;this.jor1kgui.Pause(!1),c&&(f=new ExpectTTY(this,a,c,d,e));for(var g=0;g<b.length;g++)this.jor1kgui.message.Send(a,[b.charCodeAt(g)>>>0]);return f};var b;return{getInstance:function(){return b||(b=new a,b.constructor=null),b}}}(),window.videoPlayerConfig=function(){"use strict";function a(a,b,c){a.src([{type:"video/mp4",src:b+".mp4"},{type:"video/webm",src:b+".webm"},{type:"video/ogg",src:b+".ogv"}]),a.on("loadstart",function(){var b="English";a.addRemoteTextTrack({kind:"captions",language:"en",label:b,src:"http://cs-education.github.io/sysassets/transcriptions/"+c+".webvtt"}),$("div.video-js > div.vjs-control-bar > div.vjs-captions-button > div.vjs-control-content > div.vjs-menu > ul.vjs-menu-content > li.vjs-menu-item").each(function(a,c){c.innerHTML===b&&c.click()})})}return{configure:a}}(),window.Router=function(){"use strict";function a(){var a=SysViewModel.getInstance(),b=function(){var b=!1;return function(){var c;return c=b?{done:function(){return this},fail:function(a){return a&&a(),this}}:0===a.chapters().length?$.getJSON("http://cs-education.github.io/sysassets/sys.min.json",function(b){a.chapters(b.chapters)}).fail(function(){b=!0}):{done:function(a){return a&&a(),this},fail:function(){return this}}}}(),c=function(b,c,d){var e=a.chapters()[b];e=e||{sections:[]};var f=e.sections[c];f=f||{activities:[]};var g=f.activities[d];g=g||{},a.currentChapterIdx(b),a.currentChapter(e),a.currentSectionIdx(c),a.currentSection(f),a.currentActivityIdx(d),a.currentActivity(g)},d=function(){$("#lesson-video").length>0&&videojs("lesson-video").dispose()},e=function(b){d();var c=function(c){a.setSysPlayGroundState({challengeDoc:marked(c),gccOptions:b.gccOptions||"",programArgs:b.programCommandLineArgs||"",editorText:b.code||""}),a.currentActiveTabIndex(-2),a.openManPageTabs([]),a.shownPage("playground"),a.playGroundNavPagerVisible(!0),Tracker.getInstance().trackPageView()};b.docFile?$.get("http://cs-education.github.io/sysassets/"+b.docFile).done(c).fail(function(){c(b.doc||"")}):c(b.doc||"")},f=function(b){var c=function(c){a.shownPage("video"),Tracker.getInstance().trackPageView();var e="https://cs-education.github.io/sysassets/"+b.file;a.currentVideoFilePrefix(e),a.currentVideoTopics(b.topics||""),a.currentVideoDoc(marked(c));var f=$("<video>").attr("id","lesson-video").addClass("video-js vjs-default-skin vjs-big-play-centered");d(),$("#lesson-video-container").width(960).append(f),videojs("lesson-video",{controls:!0,preload:"none",width:960,height:540,poster:""},function(){var a=b.file.replace("mp4/","");videoPlayerConfig.configure(this,e,a)})};b.docFile?$.get("http://cs-education.github.io/sysassets/"+b.docFile).done(c).fail(function(){c(b.doc||"")}):c(b.doc||"")};return Sammy(function(){this.get("/",function(){var c=this;window.location.hash="",b().done(function(){d(),a.currentChapterIdx(0),a.currentChapter(null),a.currentSectionIdx(0),a.currentSection(null),a.currentActivityIdx(0),a.currentActivity(null),a.shownPage("chapter_index"),Tracker.getInstance().trackPageView()}).fail(function(){c.redirect("#playground")})}),this.get("#chapter/:chapterIdx",function(){this.redirect("#chapter/"+this.params.chapterIdx+"/section/0/activity/0")}),this.get("#chapter/:chapterIdx/section/:sectionIdx",function(){this.redirect("#chapter/"+this.params.chapterIdx+"/section/"+this.params.sectionIdx+"/activity/0")}),this.get("#chapter/:chapterIdx/section/:sectionIdx/activity/:activityIdx",function(){var d=this;b().done(function(){c(d.params.chapterIdx,d.params.sectionIdx,d.params.activityIdx);var b=a.currentActivity();"play"===b.type?e(b):"video"===b.type?f(b):d.redirect("#/")}).fail(function(){d.redirect("#playground")})}),this.get("#playground",function(){b();var c={};c.doc="<h2>Welcome</h2><p>Welcome to this tiny but fast linux virtual machine. Currently only Chrome is known to work. Other browsers will be supported in the future.</p>",c.gccOptions="-lm -Wall -fmax-errors=10 -Wextra",c.programCommandLineArgs="",c.code='/*Write your C code here*/\n#include <stdio.h>\n\nint main() {\n    printf("Hello world!\\n");\n    return 0;\n}\n',e(c),a.playGroundNavPagerVisible(!1)})})}var b;return{getInstance:function(){return b||(b=new a,b.constructor=null),b}}}(),$(document).ready(function(){"use strict";var a=function(){var a=$("#layout").layout({livePaneResizing:!0,north__paneSelector:"#navbar-container",center__paneSelector:"#code-container",east__paneSelector:"#doc-tty-container",south__paneSelector:"#footer-container",center__minWidth:700,east__size:"50%",spacing_open:2,north__resizable:!1,north__size:33,north__spacing_open:0,north__spacing_closed:0,north__showOverflowOnHover:!0,south__resizable:!1,south__size:29,south__spacing_open:0}),b=a.panes.east.layout({livePaneResizing:!0,spacing_open:2,north__paneSelector:"#doc-container",center__paneSelector:"#tty-pane",north__size:"25%"});return{mainLayout:a,ttyLayout:b}},b=SysViewModel.getInstance(),c=new Editor("code"),d=new LiveEdit(c,SysRuntime.getInstance()),e=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name","summary"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,prefetch:{url:"http://cs-education.github.io/sysassets/man_pages/sys_man_page_index.min.json"}});e.initialize();var f=null,g=function(a){var b=a.name,c=a.section,d="https://cs-education.github.io/sysassets/man_pages/html/man"+c+"/"+b+"."+c+".html";return{tabName:b+" ("+c+")",tabHtml:'<iframe style="width: 100%; height: 100%" src="'+d+'"></iframe>'}},h=function(a){var c;a&&(c=b.openManPageTabs,c.push(g(a)),b.currentActiveTabIndex(c().length-1))},i=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,prefetch:{url:"http://cs-education.github.io/sysassets/man_pages/sys_man_page_index.min.json"}});i.initialize(),c.setTokenHighlighter(i,h),$("#man-pages-search-typeahead").children(".typeahead").typeahead({highlight:!0},{displayKey:"name",source:e.ttAdapter(),templates:{empty:['<div class="empty-message">',"unable to find any man pages that match the current query","</div>"].join("\n"),suggestion:function(a){return["<div>","<p><strong>"+a.name+'</strong><span class="pull-right"> Section '+a.section+"</span></p>","<p>"+a.summary+"</p>","</div>"].join("\n")}}}).on("typeahead:selected typeahead:autocompleted",function(a,b){f=b}).keypress(function(a){13===a.which?h(f):f=null}).keydown(function(a){8===a.which&&(f=null)}),$("#man-page-open-btn").click(function(){h(f)});var j=function(){window.setTimeout(function(){$(".tab-content").height($("#code-container").height()-$("#editor-tabs-bar").height()-5)},500)};$(window).resize(function(){c.resize(500),j()}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(a){"#editor-container"===$(a.target).attr("href")?c.resize():j()});var k={win:"Ctrl-Return",mac:"Command-Return"},l=(navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase(),m="Compile and Run ("+("mac"===l?k.mac.replace("Command","⌘"):k.win)+" in code editor)";b.compileBtnTooltip(m);var n=function(){var a=c.getText(),e=b.gccOptions();d.runCode(a,e)};$("#compile-btn").click(function(){n()}),c.addKeyboardCommand("compileAndRunShortcut",k,n,!0),$("[data-toggle=tooltip]").tooltip(),$("[data-toggle=popover]").popover().click(function(a){a.preventDefault()}),$("#editor-opts-container").find("form").submit(function(a){a.preventDefault(),a.stopPropagation()}),$("#download-file-btn").click(function(){var a=c.getText(),b=new Blob([a],{type:"text/plain;charset=utf-8"});saveAs(b,"program.c")}),$("#autoindent-code-btn").click(function(){c.autoIndentCode()}),ko.applyBindings(b),b.shownPage.subscribe(function(b){"playground"===b&&(window.layouts||(window.layouts=a()),$(window).trigger("resize"))}),Router.getInstance().run();var o=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("title","snippet"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,prefetch:{url:"https://cs-education.github.io/sysassets/transcriptions/transcription_index.min.json"}});o.initialize();var p=function(){$("#search-video").length>0&&videojs("search-video").dispose()},q=function(a){var b=$("<video>").attr("id","search-video").addClass("video-js vjs-default-skin vjs-big-play-centered");p(),$("#search-video-container").width(640).append(b);var c=videojs("search-video",{controls:!0,preload:"none",width:640,height:264,poster:""},function(){var b="https://cs-education.github.io/sysassets/mp4/"+a.source;videoPlayerConfig.configure(this,b,a.source)});c.currentTime(a.startTime),c.play()},r=null;$("#video-search-typeahead").children(".typeahead").typeahead({highlight:!0},{displayKey:"title",source:o.ttAdapter(),templates:{empty:['<div class="empty-message">',"unable to find any video lessons that match the current query","</div>"].join("\n"),suggestion:function(a){return["<div>","<p><strong>"+a.title+'</strong><span class="pull-right"> Time '+a.startTime+"</span></p>","<p>"+a.snippet+"</p>","</div>"].join("\n")}}}).on("typeahead:selected typeahead:autocompleted",function(a,b){r=b}).keypress(function(a){13===a.which?q(r):r=null}).keydown(function(a){8===a.which&&(r=null)}),$("#video-search-btn").click(function(){q(r)})});